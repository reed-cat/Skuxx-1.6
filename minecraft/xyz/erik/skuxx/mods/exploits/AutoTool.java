package xyz.erik.skuxx.mods.exploits;

import net.minecraft.block.Block;
import net.minecraft.client.Minecraft;
import net.minecraft.item.ItemShears;
import net.minecraft.item.ItemStack;
import net.minecraft.item.ItemSword;
import net.minecraft.item.ItemTool;
import net.minecraft.network.play.client.C02PacketUseEntity;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.util.BlockPos;
import net.minecraft.util.ChatComponentText;
import xyz.erik.api.helpers.ErikTimer;
import xyz.erik.api.mod.Mod;
import xyz.erik.skuxx.event.EventTarget;
import xyz.erik.skuxx.event.events.EventPacket;
import xyz.erik.skuxx.mods.Category;

public class AutoTool
extends Mod{
//arisiissisis



    public AutoTool() {
        setCategory(Category.EXPLOITS);
    }

    private ErikTimer lastSwordTimer = new ErikTimer();
    private int oldItem = -1;
    private boolean swapped;
    int startItem;
    @EventTarget
    private void packet(EventPacket e) {

        if (e.getPacket() instanceof C07PacketPlayerDigging) {
            C07PacketPlayerDigging digging = (C07PacketPlayerDigging) e.getPacket();
            if (digging.func_180762_c() == C07PacketPlayerDigging.Action.START_DESTROY_BLOCK) {
                int i = getToolIndex(digging.func_179715_a());

                if (i != -1 && (!swapped || i != oldItem)) {
                    oldItem = i;
                    if (oldItem <= 9) {
                        i += 36;
                        oldItem += 36;
                    }
                    getPlayer().swap(i, getPlayer().inventory.currentItem);
                    this.swapped = true;
                    if (startItem == -1) {
                        startItem = oldItem;
                    }
                }
            }
        }else if (e.getPacket() instanceof C03PacketPlayer) {
                if (swapped && !getMinecraft().gameSettings.keyBindAttack.pressed && oldItem != -1) {
                    getPlayer().swap(startItem, getPlayer().inventory.currentItem);
                    this.oldItem = -1;
                    this.startItem = -1;
                    this.swapped = false;
                }

        }
    }

    private int getToolIndex(BlockPos pos) {
        int blockId = Block.getIdFromBlock(Minecraft.getMinecraft().theWorld.getBlockState(pos).getBlock());
     int bestSlot = -1;
     float bestVSR = 0;
        for (int index = 1; index < 45; index++) {
            ItemStack itemStack = getPlayer().inventoryContainer.getSlot(index).getStack();
            if (itemStack != null && itemStack.getItem() != null) {
                if (itemStack.getItem() instanceof ItemTool || itemStack.getItem() instanceof ItemShears) {
                    if (itemStack.getStrVsBlock(Block.getBlockById(blockId)) > bestVSR) {
                        bestSlot = index;
                        bestVSR = itemStack.getStrVsBlock(Block.getBlockById(blockId));
                    }

                }
        }

        }


        if (bestSlot >= 36) {
            bestSlot -= 36;
        }
        if (bestVSR == 0) return -1;

        return bestSlot;
    }






}
